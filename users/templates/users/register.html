{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block content %}
{# Keep your existing styles, ensure they cover errors/alerts #}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
    body { /* Applied only if base.html doesn't cover background */
        background: linear-gradient(135deg, #007bff, #0056b3);
        min-height: 100vh; display: flex; justify-content: center; align-items: center;
        font-family: 'Inter', sans-serif;
    }
    .register-container { /* Styles specific to the register box */
        background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); padding: 2.5rem;
        border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); max-width: 420px;
        width: 90%; text-align: center; animation: fadeIn 0.6s ease-in-out;
        border: 1px solid rgba(255, 255, 255, 0.3); color: white;
    }
    .register-container h2 { font-weight: 700; margin-bottom: 20px; font-size: 26px; letter-spacing: 1px; }
    .form-group { text-align: left; margin-bottom: 15px; position: relative; }
    .form-group label { font-weight: 500; margin-bottom: 5px; display: block; color: white; font-size: 14px; }
    .form-control { /* Base style for inputs */
        border-radius: 8px; border: none; padding: 14px; font-size: 15px; width: 100%;
        background: rgba(255, 255, 255, 0.2); color: white; outline: none; transition: 0.3s ease;
        box-shadow: inset 2px 2px 5px rgba(255, 255, 255, 0.2), inset -2px -2px 5px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
    }
    .form-control::placeholder { color: rgba(255, 255, 255, 0.7); }
    .form-control:focus { background: rgba(255, 255, 255, 0.3); box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
    /* Styles for invalid fields */
    .form-control.is-invalid { border: 1px solid #dc3545; }
    .invalid-feedback { color: #ffcccc; font-size: 0.85em; margin-top: 4px; }
    .form-text { font-size: 0.8em; color: rgba(255, 255, 255, 0.8); margin-top: 4px; } /* For help text */
    /* Alert styles for messages */
    .alert { padding: 0.75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: 0.25rem; }
    .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
    .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
    .alert-info { color: #0c5460; background-color: #d1ecf1; border-color: #bee5eb; }
    .alert-warning { color: #856404; background-color: #fff3cd; border-color: #ffeeba; }

    .btn-primary { /* Submit button style */
        background: linear-gradient(135deg, #007bff, #0056b3); border: none; width: 100%; padding: 12px;
        font-size: 16px; border-radius: 10px; font-weight: 600; transition: all 0.3s ease;
        margin-top: 10px; color: white; box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2); cursor: pointer;
    }
    .btn-primary:hover { background: linear-gradient(135deg, #0056b3, #004494); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
    .login-link { margin-top: 15px; display: inline-block; color: white; font-weight: 500; text-decoration: none; transition: 0.3s; font-size: 14px; }
    .login-link:hover { text-decoration: underline; color: #cce5ff; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    /* Mobile adjustments ... */
</style>

<div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="register-container">
        <h2>Create Your Account</h2>

        {# Display non-field errors (e.g., from clean methods if not caught by fields) #}
        {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
        {% endif %}
        {# Display messages from messages framework #}
         {% if messages %}
            {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} my-2" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        {# Point form action to namespaced register URL #}
        <form method="POST" action="{% url 'users:register' %}">
            {% csrf_token %}

            {# Render username field manually #}
            <div class="form-group">
                <label for="{{ form.username.id_for_label }}">{{ form.username.label }}</label>
                <input type="text" name="{{ form.username.name }}" id="{{ form.username.id_for_label }}"
                       class="form-control {% if form.username.errors %}is-invalid{% endif %}"
                       placeholder="Choose a username" required
                       value="{{ form.username.value|default:'' }}">
                {% if form.username.help_text %}<small class="form-text">{{ form.username.help_text|safe }}</small>{% endif %}
                {% if form.username.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.username.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

            {# Render email field manually #}
            <div class="form-group">
                <label for="{{ form.email.id_for_label }}">{{ form.email.label }}</label>
                <input type="email" name="{{ form.email.name }}" id="{{ form.email.id_for_label }}"
                       class="form-control {% if form.email.errors %}is-invalid{% endif %}"
                       placeholder="Enter your email" required
                       value="{{ form.email.value|default:'' }}">
                {% if form.email.help_text %}<small class="form-text">{{ form.email.help_text|safe }}</small>{% endif %}
                {% if form.email.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.email.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

             {# Render phone_number field manually - ADDED #}
            <div class="form-group">
                <label for="{{ form.phone_number.id_for_label }}">{{ form.phone_number.label }}</label>
                <input type="text" name="{{ form.phone_number.name }}" id="{{ form.phone_number.id_for_label }}"
                       class="form-control {% if form.phone_number.errors %}is-invalid{% endif %}"
                       placeholder="e.g., 0712345678" required
                       value="{{ form.phone_number.value|default:'' }}">
                {% if form.phone_number.help_text %}<small class="form-text">{{ form.phone_number.help_text|safe }}</small>{% endif %}
                {% if form.phone_number.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.phone_number.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

            {# Render password1 field manually #}
            <div class="form-group">
                <label for="{{ form.password1.id_for_label }}">{{ form.password1.label }}</label>
                <input type="password" name="{{ form.password1.name }}" id="{{ form.password1.id_for_label }}"
                       class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
                       placeholder="Enter password" required>
                 {% if form.password1.help_text %}<small class="form-text">{{ form.password1.help_text|safe }}</small>{% endif %}
                {% if form.password1.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.password1.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

            {# Render password2 field manually #}
            <div class="form-group">
                <label for="{{ form.password2.id_for_label }}">{{ form.password2.label }}</label>
                <input type="password" name="{{ form.password2.name }}" id="{{ form.password2.id_for_label }}"
                       class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
                       placeholder="Confirm password" required>
                 {% if form.password2.help_text %}<small class="form-text">{{ form.password2.help_text|safe }}</small>{% endif %}
                {% if form.password2.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.password2.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

            <button type="submit" class="btn-primary">Register</button>
        </form>
        {# Use namespaced URL for login link #}
        <a href="{% url 'users:login' %}" class="login-link">Already have an account? Login here</a>
    </div>
</div>
{% endblock %}